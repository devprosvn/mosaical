~/workspace$ npx hardhat test


  Mosaical MVP Test Suite
    Governance System
      ✔ Should create proposals
      ✔ Should handle voting process
    NFT Vault System
      ✔ Should deposit NFT and calculate correct LTV
      ✔ Should handle risk tier updates
      ✔ Should prevent unauthorized withdrawals
    Loan Manager System
      1) Should create loan with correct parameters
      ✔ Should calculate dynamic interest rates
      2) Should handle loan repayment correctly
    DPO Token System
      3) Should mint DPO tokens on loan creation
      4) "before each" hook for "Should handle DPO token trading"


  6 passing (2s)
  4 failing

  1) Mosaical MVP Test Suite
       Loan Manager System
         Should create loan with correct parameters:
     Error: VM Exception while processing transaction: reverted with reason string 'Exceeds max LTV'
    at LoanManagerV3.repay (contracts/LoanManagerV3.sol:151)
    at LoanManagerV3.borrow (contracts/LoanManagerV3.sol:122)
    at EdrProviderWrapper.request (node_modules/hardhat/src/internal/hardhat-network/provider/provider.ts:359:41)
    at HardhatEthersSigner.sendTransaction (node_modules/@nomicfoundation/hardhat-ethers/src/signers.ts:181:18)
    at send (node_modules/ethers/src.ts/contract/contract.ts:313:20)
    at Proxy.borrow (node_modules/ethers/src.ts/contract/contract.ts:352:16)
    at Context.<anonymous> (test/MosaicalMVP.test.js:167:7)
  

  2) Mosaical MVP Test Suite
       Loan Manager System
         Should handle loan repayment correctly:
     Error: VM Exception while processing transaction: reverted with reason string 'Exceeds max LTV'
    at LoanManagerV3.repay (contracts/LoanManagerV3.sol:151)
    at LoanManagerV3.borrow (contracts/LoanManagerV3.sol:122)
    at EdrProviderWrapper.request (node_modules/hardhat/src/internal/hardhat-network/provider/provider.ts:359:41)
    at HardhatEthersSigner.sendTransaction (node_modules/@nomicfoundation/hardhat-ethers/src/signers.ts:181:18)
    at send (node_modules/ethers/src.ts/contract/contract.ts:313:20)
    at Proxy.borrow (node_modules/ethers/src.ts/contract/contract.ts:352:16)
    at Context.<anonymous> (test/MosaicalMVP.test.js:210:7)
  

  3) Mosaical MVP Test Suite
       DPO Token System
         Should mint DPO tokens on loan creation:
     Error: VM Exception while processing transaction: reverted with reason string 'Exceeds max LTV'
    at LoanManagerV3.repay (contracts/LoanManagerV3.sol:151)
    at LoanManagerV3.borrow (contracts/LoanManagerV3.sol:122)
    at EdrProviderWrapper.request (node_modules/hardhat/src/internal/hardhat-network/provider/provider.ts:359:41)
    at HardhatEthersSigner.sendTransaction (node_modules/@nomicfoundation/hardhat-ethers/src/signers.ts:181:18)
    at send (node_modules/ethers/src.ts/contract/contract.ts:313:20)
    at Proxy.borrow (node_modules/ethers/src.ts/contract/contract.ts:352:16)
    at Context.<anonymous> (test/MosaicalMVP.test.js:252:7)
  

  4) Mosaical MVP Test Suite
       "before each" hook for "Should handle DPO token trading":
     ProviderError: Sender doesn't have enough funds to send tx. The max upfront cost is: 1000030000000480000000 and the sender's balance is: 849879616754059246121.
      at EdrProviderWrapper.request (/home/runner/workspace/node_modules/hardhat/src/internal/hardhat-network/provider/provider.ts:368:19)
      at HardhatEthersSigner.sendTransaction (/home/runner/workspace/node_modules/@nomicfoundation/hardhat-ethers/src/signers.ts:181:18)
      at Context.<anonymous> (/home/runner/workspace/test/MosaicalMVP.test.js:65:5)